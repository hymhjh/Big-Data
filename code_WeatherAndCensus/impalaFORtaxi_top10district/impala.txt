/*get top 10 census tract district of taxi*/
create external table pickup (date_time string, pick_name string, number int)                 row format delimited fields terminated by ','                 location '/user/cloudera/impalainput/picktaxi';create external table dropoff (date_time string, drop_name string, number int)                 row format delimited fields terminated by ','                 location '/user/cloudera/impalainput/droptaxi';create external table pickup_dropoff (date_time string, pick_name string, drop_name string, number int)                 row format delimited fields terminated by ','                 location '/user/cloudera/impalainput/odtaxi';select pick10.date_time, pick10.pick_name, pick10.number, drop10.drop_name, drop10.number, od10.pick_name, od10.drop_name, od10.number, pick10.rn from (select date_time, pick_name, number, row_number() over(order by number desc) as rn from pickup where date_time = '2016050208' order by number desc limit 10)as pick10, (select date_time, drop_name, number, row_number() over(order by number desc) as rn from dropoff where date_time = '2016050208' order by number desc limit 10)as drop10, (select date_time, pick_name, drop_name, number, row_number() over(order by number desc) as rn from pickup_dropoff where date_time = '08' order by number desc limit 10)as od10 where pick10.rn = drop10.rn and drop10.rn = od10.rn;


select pick10.date_time, pick10.pick_name, pick10.number, drop10.drop_name, drop10.number, od10.pick_name, od10.drop_name, od10.number, pick10.rn from (select date_time, pick_name, number, row_number() over(order by number desc) as rn from pickup where date_time = '2016050218' order by number desc limit 10)as pick10, (select date_time, drop_name, number, row_number() over(order by number desc) as rn from dropoff where date_time = '2016050218' order by number desc limit 10)as drop10, (select date_time, pick_name, drop_name, number, row_number() over(order by number desc) as rn from pickup_dropoff where date_time = '18' order by number desc limit 10)as od10 where pick10.rn = drop10.rn and drop10.rn = od10.rn;

